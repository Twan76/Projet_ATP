mutate(icon_categorie = icon_categorystamp)
df_select_categorystamp <- data.frame(deb = str_locate(categorystamp, "/assets/atpwt/images/tournament/badges/categorystamps_")[,2])
categorystamp <- substr(categorystamp, df_select_categorystamp[,"deb"]+1, nchar(categorystamp)-4)
for(i in 1:length(categorystamp)){
if(categorystamp[i] == "challenger") {
categorystamp[i] <- temp[i]
}
}
# Recuperer lien joueur atp world tour + photo si possible
tournois_details <- tournois_details %>% #Take the players data frame
mutate(Categorie = categorystamp)
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"  ","")
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"\r\n"," ")
# Renommer les catégories
select_atp_250 <- (tournois_details$Categorie == 250)
select_atp_500 <- (tournois_details$Categorie == 500)
select_atp_1000 <- (tournois_details$Categorie == 1000)
select_atp_grand_chelem <- (tournois_details$Categorie == "grandslam")
tournois_details[select_atp_250,5] <- "ATP 250"
tournois_details[select_atp_500,5] <- "ATP 500"
tournois_details[select_atp_1000,5] <- "Masters 1000"
tournois_details[select_atp_grand_chelem,5] <- "Grand Chelem"
# Supprimer les tournois spéciaux, type atp cup
tournois_details <- tournois_details[tournois_details$Categorie %in% c("ATP 250", "ATP 500", "Masters 1000", "Grand Chelem", "Challenger 50", "Challenger 80", "Challenger 90", "Challenger 100", "Challenger 125"),]
tournois_details$Details <- str_replace_all(tournois_details$Details,"  ","")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n\r\n\r\n\r\n",", ")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n","")
for(j in 1:length(tournois_details$Details)){
if(length(unlist(str_split(tournois_details$Details,",")[[j]]))==5) {
tournois_details$Details[j] <- paste0(unlist(str_split(tournois_details$Details,",")[[j]])[1],",",unlist(str_split(tournois_details$Details,",")[[j]])[2],",",unlist(str_split(tournois_details$Details,",")[[j]])[4],",",unlist(str_split(tournois_details$Details,",")[[j]])[5], sep=" ")
}
}
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"  ","")
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"\r\n\r\n",", ")
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"  ","")
df_select <- data.frame(deb = str_locate(tournois_details$Vainqueur, "SGL")[,1], fin = str_locate(tournois_details$Vainqueur, "DBL")[,1])
tournois_details$Vainqueur <- substr(tournois_details$Vainqueur, df_select[,"deb"]+3, df_select[,"fin"]-1)
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"\r\n","")
tournois_details <- separate(tournois_details, col="Details", into=c("Tournoi","Ville","Pays","Date"), sep=", ")
tournois_details <- separate(tournois_details, col="Date", into=c("Debut","Fin"), sep="-")
return(tournois_details)
}
tournois_details_ATP <- tournois_details(wiki_URL_ATP_World_Tour)
tournois_details_Challenger <- tournois_details(wiki_URL_ATP_Challenger)
tournament_details_final <- rbind(tournois_details_ATP,tournois_details_Challenger)
View(tournament_details_final)
View(tournament_details_final)
str(tournament_details_final)
tournois_details <- read_html(x) %>%
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_table(fill = TRUE)
tournois_details <- rbindlist(tournois_details)
temp <- tournois_details[seq(1,nrow(tournois_details),2),6] #
tournois_details <- tournois_details[seq(1,nrow(tournois_details),2),c(2,5,7)]
names(tournois_details) <- c("Details", "Surface", "Vainqueur")
# Recuperer categorie tournoi (250, 500, etc)
categorystamp <- read_html(x) %>% #Back to Wikipedia we go
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_nodes("td > img") %>%
html_attr("src") #Grab its URL location
icon_categorystamp <- paste0("https://www.atptour.com", categorystamp)
tournois_details <-tournois_details %>% #Take the players data frame
mutate(icon_categorie = icon_categorystamp)
df_select_categorystamp <- data.frame(deb = str_locate(categorystamp, "/assets/atpwt/images/tournament/badges/categorystamps_")[,2])
categorystamp <- substr(categorystamp, df_select_categorystamp[,"deb"]+1, nchar(categorystamp)-4)
for(i in 1:length(categorystamp)){
if(categorystamp[i] == "challenger") {
categorystamp[i] <- temp[i]
}
}
# Recuperer lien joueur atp world tour + photo si possible
tournois_details <- tournois_details %>% #Take the players data frame
mutate(Categorie = categorystamp)
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"  ","")
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"\r\n"," ")
# Renommer les catégories
select_atp_250 <- (tournois_details$Categorie == 250)
select_atp_500 <- (tournois_details$Categorie == 500)
select_atp_1000 <- (tournois_details$Categorie == 1000)
select_atp_grand_chelem <- (tournois_details$Categorie == "grandslam")
tournois_details[select_atp_250,5] <- "ATP 250"
tournois_details[select_atp_500,5] <- "ATP 500"
tournois_details[select_atp_1000,5] <- "Masters 1000"
tournois_details[select_atp_grand_chelem,5] <- "Grand Chelem"
# Supprimer les tournois spéciaux, type atp cup
tournois_details <- tournois_details[tournois_details$Categorie %in% c("ATP 250", "ATP 500", "Masters 1000", "Grand Chelem", "Challenger 50", "Challenger 80", "Challenger 90", "Challenger 100", "Challenger 125"),]
tournois_details$Details <- str_replace_all(tournois_details$Details,"  ","")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n\r\n\r\n\r\n",", ")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n","")
for(j in 1:length(tournois_details$Details)){
if(length(unlist(str_split(tournois_details$Details,",")[[j]]))==5) {
tournois_details$Details[j] <- paste0(unlist(str_split(tournois_details$Details,",")[[j]])[1],",",unlist(str_split(tournois_details$Details,",")[[j]])[2],",",unlist(str_split(tournois_details$Details,",")[[j]])[4],",",unlist(str_split(tournois_details$Details,",")[[j]])[5], sep=" ")
}
}
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"  ","")
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"\r\n\r\n",", ")
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"  ","")
df_select <- data.frame(deb = str_locate(tournois_details$Vainqueur, "SGL")[,1], fin = str_locate(tournois_details$Vainqueur, "DBL")[,1])
tournois_details$Vainqueur <- substr(tournois_details$Vainqueur, df_select[,"deb"]+3, df_select[,"fin"]-1)
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"\r\n","")
tournois_details <- separate(tournois_details, col="Details", into=c("Tournoi","Ville","Pays","Date"), sep=", ")
tournois_details <- separate(tournois_details, col="Date", into=c("Debut","Fin"), sep=" - ")
wiki_URL_ATP_World_Tour <- "https://www.atptour.com/en/tournaments"
wiki_URL_ATP_Challenger <- "https://www.atptour.com/en/atp-challenger-tour/calendar"
# Recuperer uniquement données du tournoi (y compris non joués)
tournois_details <- function(x)  {
tournois_details <- read_html(x) %>%
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_table(fill = TRUE)
tournois_details <- rbindlist(tournois_details)
temp <- tournois_details[seq(1,nrow(tournois_details),2),6] #
tournois_details <- tournois_details[seq(1,nrow(tournois_details),2),c(2,5,7)]
names(tournois_details) <- c("Details", "Surface", "Vainqueur")
# Recuperer categorie tournoi (250, 500, etc)
categorystamp <- read_html(x) %>% #Back to Wikipedia we go
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_nodes("td > img") %>%
html_attr("src") #Grab its URL location
icon_categorystamp <- paste0("https://www.atptour.com", categorystamp)
tournois_details <-tournois_details %>% #Take the players data frame
mutate(icon_categorie = icon_categorystamp)
df_select_categorystamp <- data.frame(deb = str_locate(categorystamp, "/assets/atpwt/images/tournament/badges/categorystamps_")[,2])
categorystamp <- substr(categorystamp, df_select_categorystamp[,"deb"]+1, nchar(categorystamp)-4)
for(i in 1:length(categorystamp)){
if(categorystamp[i] == "challenger") {
categorystamp[i] <- temp[i]
}
}
# Recuperer lien joueur atp world tour + photo si possible
tournois_details <- tournois_details %>% #Take the players data frame
mutate(Categorie = categorystamp)
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"  ","")
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"\r\n"," ")
# Renommer les catégories
select_atp_250 <- (tournois_details$Categorie == 250)
select_atp_500 <- (tournois_details$Categorie == 500)
select_atp_1000 <- (tournois_details$Categorie == 1000)
select_atp_grand_chelem <- (tournois_details$Categorie == "grandslam")
tournois_details[select_atp_250,5] <- "ATP 250"
tournois_details[select_atp_500,5] <- "ATP 500"
tournois_details[select_atp_1000,5] <- "Masters 1000"
tournois_details[select_atp_grand_chelem,5] <- "Grand Chelem"
# Supprimer les tournois spéciaux, type atp cup
tournois_details <- tournois_details[tournois_details$Categorie %in% c("ATP 250", "ATP 500", "Masters 1000", "Grand Chelem", "Challenger 50", "Challenger 80", "Challenger 90", "Challenger 100", "Challenger 125"),]
tournois_details$Details <- str_replace_all(tournois_details$Details,"  ","")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n\r\n\r\n\r\n",", ")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n","")
for(j in 1:length(tournois_details$Details)){
if(length(unlist(str_split(tournois_details$Details,",")[[j]]))==5) {
tournois_details$Details[j] <- paste0(unlist(str_split(tournois_details$Details,",")[[j]])[1],",",unlist(str_split(tournois_details$Details,",")[[j]])[2],",",unlist(str_split(tournois_details$Details,",")[[j]])[4],",",unlist(str_split(tournois_details$Details,",")[[j]])[5], sep=" ")
}
}
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"  ","")
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"\r\n\r\n",", ")
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"  ","")
df_select <- data.frame(deb = str_locate(tournois_details$Vainqueur, "SGL")[,1], fin = str_locate(tournois_details$Vainqueur, "DBL")[,1])
tournois_details$Vainqueur <- substr(tournois_details$Vainqueur, df_select[,"deb"]+3, df_select[,"fin"]-1)
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"\r\n","")
tournois_details <- separate(tournois_details, col="Details", into=c("Tournoi","Ville","Pays","Date"), sep=", ")
tournois_details <- separate(tournois_details, col="Date", into=c("Debut","Fin"), sep=" - ")
return(tournois_details)
}
tournois_details_ATP <- tournois_details(wiki_URL_ATP_World_Tour)
tournois_details_Challenger <- tournois_details(wiki_URL_ATP_Challenger)
tournament_details_final <- rbind(tournois_details_ATP,tournois_details_Challenger)
#Saving for the app
write_rds(tournament_details_final, "tournament_details_final.rds")
tournament_details_final_df <- readr::read_rds("tournament_details_final.rds")
str(tournament_details_final_df)
as.Date(tournament_details_final_df$Debut,origin="1899-12-30")
as.Date(tournament_details_final_df$Debut)
?format
tournois_details <- read_html(x) %>%
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_table(fill = TRUE)
tournois_details <- rbindlist(tournois_details)
temp <- tournois_details[seq(1,nrow(tournois_details),2),6] #
tournois_details <- tournois_details[seq(1,nrow(tournois_details),2),c(2,5,7)]
names(tournois_details) <- c("Details", "Surface", "Vainqueur")
# Recuperer categorie tournoi (250, 500, etc)
categorystamp <- read_html(x) %>% #Back to Wikipedia we go
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_nodes("td > img") %>%
html_attr("src") #Grab its URL location
icon_categorystamp <- paste0("https://www.atptour.com", categorystamp)
tournois_details <-tournois_details %>% #Take the players data frame
mutate(icon_categorie = icon_categorystamp)
df_select_categorystamp <- data.frame(deb = str_locate(categorystamp, "/assets/atpwt/images/tournament/badges/categorystamps_")[,2])
categorystamp <- substr(categorystamp, df_select_categorystamp[,"deb"]+1, nchar(categorystamp)-4)
for(i in 1:length(categorystamp)){
if(categorystamp[i] == "challenger") {
categorystamp[i] <- temp[i]
}
}
# Recuperer lien joueur atp world tour + photo si possible
tournois_details <- tournois_details %>% #Take the players data frame
mutate(Categorie = categorystamp)
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"  ","")
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"\r\n"," ")
# Renommer les catégories
select_atp_250 <- (tournois_details$Categorie == 250)
select_atp_500 <- (tournois_details$Categorie == 500)
select_atp_1000 <- (tournois_details$Categorie == 1000)
select_atp_grand_chelem <- (tournois_details$Categorie == "grandslam")
tournois_details[select_atp_250,5] <- "ATP 250"
tournois_details[select_atp_500,5] <- "ATP 500"
tournois_details[select_atp_1000,5] <- "Masters 1000"
tournois_details[select_atp_grand_chelem,5] <- "Grand Chelem"
# Supprimer les tournois spéciaux, type atp cup
tournois_details <- tournois_details[tournois_details$Categorie %in% c("ATP 250", "ATP 500", "Masters 1000", "Grand Chelem", "Challenger 50", "Challenger 80", "Challenger 90", "Challenger 100", "Challenger 125"),]
tournois_details$Details <- str_replace_all(tournois_details$Details,"  ","")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n\r\n\r\n\r\n",", ")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n","")
for(j in 1:length(tournois_details$Details)){
if(length(unlist(str_split(tournois_details$Details,",")[[j]]))==5) {
tournois_details$Details[j] <- paste0(unlist(str_split(tournois_details$Details,",")[[j]])[1],",",unlist(str_split(tournois_details$Details,",")[[j]])[2],",",unlist(str_split(tournois_details$Details,",")[[j]])[4],",",unlist(str_split(tournois_details$Details,",")[[j]])[5], sep=" ")
}
}
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"  ","")
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"\r\n\r\n",", ")
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"  ","")
df_select <- data.frame(deb = str_locate(tournois_details$Vainqueur, "SGL")[,1], fin = str_locate(tournois_details$Vainqueur, "DBL")[,1])
tournois_details$Vainqueur <- substr(tournois_details$Vainqueur, df_select[,"deb"]+3, df_select[,"fin"]-1)
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"\r\n","")
tournois_details <- separate(tournois_details, col="Details", into=c("Tournoi","Ville","Pays","Date"), sep=", ")
tournois_details <- separate(tournois_details, col="Date", into=c("Debut","Fin"), sep="-")
tournois_details <- read_html(x) %>%
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_table(fill = TRUE)
tournois_details <- rbindlist(tournois_details)
temp <- tournois_details[seq(1,nrow(tournois_details),2),6] #
tournois_details <- tournois_details[seq(1,nrow(tournois_details),2),c(2,5,7)]
names(tournois_details) <- c("Details", "Surface", "Vainqueur")
# Recuperer categorie tournoi (250, 500, etc)
categorystamp <- read_html(x) %>% #Back to Wikipedia we go
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_nodes("td > img") %>%
html_attr("src") #Grab its URL location
icon_categorystamp <- paste0("https://www.atptour.com", categorystamp)
tournois_details <-tournois_details %>% #Take the players data frame
mutate(icon_categorie = icon_categorystamp)
df_select_categorystamp <- data.frame(deb = str_locate(categorystamp, "/assets/atpwt/images/tournament/badges/categorystamps_")[,2])
categorystamp <- substr(categorystamp, df_select_categorystamp[,"deb"]+1, nchar(categorystamp)-4)
for(i in 1:length(categorystamp)){
if(categorystamp[i] == "challenger") {
categorystamp[i] <- temp[i]
}
}
# Recuperer lien joueur atp world tour + photo si possible
tournois_details <- tournois_details %>% #Take the players data frame
mutate(Categorie = categorystamp)
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"  ","")
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"\r\n"," ")
# Renommer les catégories
select_atp_250 <- (tournois_details$Categorie == 250)
select_atp_500 <- (tournois_details$Categorie == 500)
select_atp_1000 <- (tournois_details$Categorie == 1000)
select_atp_grand_chelem <- (tournois_details$Categorie == "grandslam")
tournois_details[select_atp_250,5] <- "ATP 250"
tournois_details[select_atp_500,5] <- "ATP 500"
tournois_details[select_atp_1000,5] <- "Masters 1000"
tournois_details[select_atp_grand_chelem,5] <- "Grand Chelem"
# Supprimer les tournois spéciaux, type atp cup
tournois_details <- tournois_details[tournois_details$Categorie %in% c("ATP 250", "ATP 500", "Masters 1000", "Grand Chelem", "Challenger 50", "Challenger 80", "Challenger 90", "Challenger 100", "Challenger 125"),]
tournois_details$Details <- str_replace_all(tournois_details$Details,"  ","")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n\r\n\r\n\r\n",", ")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n","")
for(j in 1:length(tournois_details$Details)){
if(length(unlist(str_split(tournois_details$Details,",")[[j]]))==5) {
tournois_details$Details[j] <- paste0(unlist(str_split(tournois_details$Details,",")[[j]])[1],",",unlist(str_split(tournois_details$Details,",")[[j]])[2],",",unlist(str_split(tournois_details$Details,",")[[j]])[4],",",unlist(str_split(tournois_details$Details,",")[[j]])[5], sep=" ")
}
}
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"  ","")
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"\r\n\r\n",", ")
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"  ","")
df_select <- data.frame(deb = str_locate(tournois_details$Vainqueur, "SGL")[,1], fin = str_locate(tournois_details$Vainqueur, "DBL")[,1])
tournois_details$Vainqueur <- substr(tournois_details$Vainqueur, df_select[,"deb"]+3, df_select[,"fin"]-1)
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"\r\n","")
tournois_details <- separate(tournois_details, col="Details", into=c("Tournoi","Ville","Pays","Date"), sep=", ")
tournois_details <- separate(tournois_details, col="Date", into=c("Debut","Fin"), sep="- ")
tournois_details$Debut <- str_replace_all(tournois_details$Debut, "\\.", "/")
today(tzone = )
wiki_URL_ATP_World_Tour <- "https://www.atptour.com/en/tournaments"
wiki_URL_ATP_Challenger <- "https://www.atptour.com/en/atp-challenger-tour/calendar"
# Recuperer uniquement données du tournoi (y compris non joués)
tournois_details <- function(x)  {
tournois_details <- read_html(x) %>%
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_table(fill = TRUE)
tournois_details <- rbindlist(tournois_details)
temp <- tournois_details[seq(1,nrow(tournois_details),2),6] #
tournois_details <- tournois_details[seq(1,nrow(tournois_details),2),c(2,5,7)]
names(tournois_details) <- c("Details", "Surface", "Vainqueur")
# Recuperer categorie tournoi (250, 500, etc)
categorystamp <- read_html(x) %>% #Back to Wikipedia we go
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_nodes("td > img") %>%
html_attr("src") #Grab its URL location
icon_categorystamp <- paste0("https://www.atptour.com", categorystamp)
tournois_details <-tournois_details %>% #Take the players data frame
mutate(icon_categorie = icon_categorystamp)
df_select_categorystamp <- data.frame(deb = str_locate(categorystamp, "/assets/atpwt/images/tournament/badges/categorystamps_")[,2])
categorystamp <- substr(categorystamp, df_select_categorystamp[,"deb"]+1, nchar(categorystamp)-4)
for(i in 1:length(categorystamp)){
if(categorystamp[i] == "challenger") {
categorystamp[i] <- temp[i]
}
}
# Recuperer lien joueur atp world tour + photo si possible
tournois_details <- tournois_details %>% #Take the players data frame
mutate(Categorie = categorystamp)
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"  ","")
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"\r\n"," ")
# Renommer les catégories
select_atp_250 <- (tournois_details$Categorie == 250)
select_atp_500 <- (tournois_details$Categorie == 500)
select_atp_1000 <- (tournois_details$Categorie == 1000)
select_atp_grand_chelem <- (tournois_details$Categorie == "grandslam")
tournois_details[select_atp_250,5] <- "ATP 250"
tournois_details[select_atp_500,5] <- "ATP 500"
tournois_details[select_atp_1000,5] <- "Masters 1000"
tournois_details[select_atp_grand_chelem,5] <- "Grand Chelem"
# Supprimer les tournois spéciaux, type atp cup
tournois_details <- tournois_details[tournois_details$Categorie %in% c("ATP 250", "ATP 500", "Masters 1000", "Grand Chelem", "Challenger 50", "Challenger 80", "Challenger 90", "Challenger 100", "Challenger 125"),]
tournois_details$Details <- str_replace_all(tournois_details$Details,"  ","")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n\r\n\r\n\r\n",", ")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n","")
for(j in 1:length(tournois_details$Details)){
if(length(unlist(str_split(tournois_details$Details,",")[[j]]))==5) {
tournois_details$Details[j] <- paste0(unlist(str_split(tournois_details$Details,",")[[j]])[1],",",unlist(str_split(tournois_details$Details,",")[[j]])[2],",",unlist(str_split(tournois_details$Details,",")[[j]])[4],",",unlist(str_split(tournois_details$Details,",")[[j]])[5], sep=" ")
}
}
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"  ","")
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"\r\n\r\n",", ")
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"  ","")
df_select <- data.frame(deb = str_locate(tournois_details$Vainqueur, "SGL")[,1], fin = str_locate(tournois_details$Vainqueur, "DBL")[,1])
tournois_details$Vainqueur <- substr(tournois_details$Vainqueur, df_select[,"deb"]+3, df_select[,"fin"]-1)
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"\r\n","")
tournois_details <- separate(tournois_details, col="Details", into=c("Tournoi","Ville","Pays","Date"), sep=", ")
tournois_details <- separate(tournois_details, col="Date", into=c("Debut","Fin"), sep="- ")
#  Format date
tournois_details$Debut <- str_replace_all(tournois_details$Debut, "\\.", "-")
tournois_details$Debut <- as.Date(tournois_details$Debut)
tournois_details$Fin <- str_replace_all(tournois_details$Fin, " ", "")
tournois_details$Fin <- str_replace_all(tournois_details$Fin, "\\.", "-")
tournois_details$Fin <- as.Date(tournois_details$Fin)
# Renommer les surfaces
select_atp_outdoor_hard <- (tournois_details$Surface == "Outdoor, Hard")
select_atp_outdoor_clay <- (tournois_details$Surface == "Outdoor, Clay")
select_atp_outdoor_grass <- (tournois_details$Surface == "Outdoor, Grass")
select_atp_indoor_hard <- (tournois_details$Surface == "Indoor, Hard")
select_atp_indoor_clay <- (tournois_details$Surface == "Indoor, Clay")
tournois_details[select_atp_outdoor_hard,6] <- "Dur ext."
tournois_details[select_atp_outdoor_clay,6] <- "TB ext."
tournois_details[select_atp_outdoor_grass,6] <- "Gazon"
tournois_details[select_atp_indoor_hard,6] <- "Dur int."
tournois_details[select_atp_indoor_clay,6] <- "TB int."
return(tournois_details)
}
tournois_details_ATP <- tournois_details(wiki_URL_ATP_World_Tour)
tournois_details_Challenger <- tournois_details(wiki_URL_ATP_Challenger)
tournament_details_final <- rbind(tournois_details_ATP,tournois_details_Challenger)
View(tournament_details_final)
tournois_details <- read_html(x) %>%
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_table(fill = TRUE)
tournois_details <- rbindlist(tournois_details)
temp <- tournois_details[seq(1,nrow(tournois_details),2),6] #
tournois_details <- tournois_details[seq(1,nrow(tournois_details),2),c(2,5,7)]
names(tournois_details) <- c("Details", "Surface", "Vainqueur")
# Recuperer categorie tournoi (250, 500, etc)
categorystamp <- read_html(x) %>% #Back to Wikipedia we go
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_nodes("td > img") %>%
html_attr("src") #Grab its URL location
icon_categorystamp <- paste0("https://www.atptour.com", categorystamp)
tournois_details <-tournois_details %>% #Take the players data frame
mutate(icon_categorie = icon_categorystamp)
df_select_categorystamp <- data.frame(deb = str_locate(categorystamp, "/assets/atpwt/images/tournament/badges/categorystamps_")[,2])
categorystamp <- substr(categorystamp, df_select_categorystamp[,"deb"]+1, nchar(categorystamp)-4)
for(i in 1:length(categorystamp)){
if(categorystamp[i] == "challenger") {
categorystamp[i] <- temp[i]
}
}
# Recuperer lien joueur atp world tour + photo si possible
tournois_details <- tournois_details %>% #Take the players data frame
mutate(Categorie = categorystamp)
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"  ","")
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"\r\n"," ")
# Renommer les catégories
select_atp_250 <- (tournois_details$Categorie == 250)
select_atp_500 <- (tournois_details$Categorie == 500)
select_atp_1000 <- (tournois_details$Categorie == 1000)
select_atp_grand_chelem <- (tournois_details$Categorie == "grandslam")
tournois_details[select_atp_250,5] <- "ATP 250"
tournois_details[select_atp_500,5] <- "ATP 500"
tournois_details[select_atp_1000,5] <- "Masters 1000"
tournois_details[select_atp_grand_chelem,5] <- "Grand Chelem"
# Supprimer les tournois spéciaux, type atp cup
tournois_details <- tournois_details[tournois_details$Categorie %in% c("ATP 250", "ATP 500", "Masters 1000", "Grand Chelem", "Challenger 50", "Challenger 80", "Challenger 90", "Challenger 100", "Challenger 125"),]
tournois_details$Details <- str_replace_all(tournois_details$Details,"  ","")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n\r\n\r\n\r\n",", ")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n","")
for(j in 1:length(tournois_details$Details)){
if(length(unlist(str_split(tournois_details$Details,",")[[j]]))==5) {
tournois_details$Details[j] <- paste0(unlist(str_split(tournois_details$Details,",")[[j]])[1],",",unlist(str_split(tournois_details$Details,",")[[j]])[2],",",unlist(str_split(tournois_details$Details,",")[[j]])[4],",",unlist(str_split(tournois_details$Details,",")[[j]])[5], sep=" ")
}
}
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"  ","")
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"\r\n\r\n",", ")
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"  ","")
df_select <- data.frame(deb = str_locate(tournois_details$Vainqueur, "SGL")[,1], fin = str_locate(tournois_details$Vainqueur, "DBL")[,1])
tournois_details$Vainqueur <- substr(tournois_details$Vainqueur, df_select[,"deb"]+3, df_select[,"fin"]-1)
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"\r\n","")
tournois_details <- separate(tournois_details, col="Details", into=c("Tournoi","Ville","Pays","Date"), sep=", ")
View(tournois_details)
tournois_details <- separate(tournois_details, col="Date", into=c("Debut","Fin"), sep=" - ")
wiki_URL_ATP_World_Tour <- "https://www.atptour.com/en/tournaments"
wiki_URL_ATP_Challenger <- "https://www.atptour.com/en/atp-challenger-tour/calendar"
# Recuperer uniquement données du tournoi (y compris non joués)
tournois_details <- function(x)  {
tournois_details <- read_html(x) %>%
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_table(fill = TRUE)
tournois_details <- rbindlist(tournois_details)
temp <- tournois_details[seq(1,nrow(tournois_details),2),6] #
tournois_details <- tournois_details[seq(1,nrow(tournois_details),2),c(2,5,7)]
names(tournois_details) <- c("Details", "Surface", "Vainqueur")
# Recuperer categorie tournoi (250, 500, etc)
categorystamp <- read_html(x) %>% #Back to Wikipedia we go
html_nodes(xpath = '//*[@class="tourney-results-wrapper"]') %>%
html_nodes("td > img") %>%
html_attr("src") #Grab its URL location
icon_categorystamp <- paste0("https://www.atptour.com", categorystamp)
tournois_details <-tournois_details %>% #Take the players data frame
mutate(icon_categorie = icon_categorystamp)
df_select_categorystamp <- data.frame(deb = str_locate(categorystamp, "/assets/atpwt/images/tournament/badges/categorystamps_")[,2])
categorystamp <- substr(categorystamp, df_select_categorystamp[,"deb"]+1, nchar(categorystamp)-4)
for(i in 1:length(categorystamp)){
if(categorystamp[i] == "challenger") {
categorystamp[i] <- temp[i]
}
}
# Recuperer lien joueur atp world tour + photo si possible
tournois_details <- tournois_details %>% #Take the players data frame
mutate(Categorie = categorystamp)
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"  ","")
tournois_details$Categorie <- str_replace_all(tournois_details$Categorie,"\r\n"," ")
# Renommer les catégories
select_atp_250 <- (tournois_details$Categorie == 250)
select_atp_500 <- (tournois_details$Categorie == 500)
select_atp_1000 <- (tournois_details$Categorie == 1000)
select_atp_grand_chelem <- (tournois_details$Categorie == "grandslam")
tournois_details[select_atp_250,5] <- "ATP 250"
tournois_details[select_atp_500,5] <- "ATP 500"
tournois_details[select_atp_1000,5] <- "Masters 1000"
tournois_details[select_atp_grand_chelem,5] <- "Grand Chelem"
# Supprimer les tournois spéciaux, type atp cup
tournois_details <- tournois_details[tournois_details$Categorie %in% c("ATP 250", "ATP 500", "Masters 1000", "Grand Chelem", "Challenger 50", "Challenger 80", "Challenger 90", "Challenger 100", "Challenger 125"),]
tournois_details$Details <- str_replace_all(tournois_details$Details,"  ","")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n\r\n\r\n\r\n",", ")
tournois_details$Details <- str_replace_all(tournois_details$Details,"\r\n","")
for(j in 1:length(tournois_details$Details)){
if(length(unlist(str_split(tournois_details$Details,",")[[j]]))==5) {
tournois_details$Details[j] <- paste0(unlist(str_split(tournois_details$Details,",")[[j]])[1],",",unlist(str_split(tournois_details$Details,",")[[j]])[2],",",unlist(str_split(tournois_details$Details,",")[[j]])[4],",",unlist(str_split(tournois_details$Details,",")[[j]])[5], sep=" ")
}
}
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"  ","")
tournois_details$Surface <- str_replace_all(tournois_details$Surface,"\r\n\r\n",", ")
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"  ","")
df_select <- data.frame(deb = str_locate(tournois_details$Vainqueur, "SGL")[,1], fin = str_locate(tournois_details$Vainqueur, "DBL")[,1])
tournois_details$Vainqueur <- substr(tournois_details$Vainqueur, df_select[,"deb"]+3, df_select[,"fin"]-1)
tournois_details$Vainqueur <- str_replace_all(tournois_details$Vainqueur,"\r\n","")
tournois_details <- separate(tournois_details, col="Details", into=c("Tournoi","Ville","Pays","Date"), sep=", ")
tournois_details <- separate(tournois_details, col="Date", into=c("Debut","Fin"), sep=" - ")
#  Format date
tournois_details$Debut <- str_replace_all(tournois_details$Debut, "\\.", "-")
tournois_details$Debut <- as.Date(tournois_details$Debut)
tournois_details$Fin <- str_replace_all(tournois_details$Fin, "\\.", "-")
tournois_details$Fin <- as.Date(tournois_details$Fin)
# Renommer les surfaces
select_atp_outdoor_hard <- (tournois_details$Surface == "Outdoor, Hard")
select_atp_outdoor_clay <- (tournois_details$Surface == "Outdoor, Clay")
select_atp_outdoor_grass <- (tournois_details$Surface == "Outdoor, Grass")
select_atp_indoor_hard <- (tournois_details$Surface == "Indoor, Hard")
select_atp_indoor_clay <- (tournois_details$Surface == "Indoor, Clay")
tournois_details[select_atp_outdoor_hard,6] <- "Dur ext."
tournois_details[select_atp_outdoor_clay,6] <- "TB ext."
tournois_details[select_atp_outdoor_grass,6] <- "Gazon"
tournois_details[select_atp_indoor_hard,6] <- "Dur int."
tournois_details[select_atp_indoor_clay,6] <- "TB int."
return(tournois_details)
}
tournois_details_ATP <- tournois_details(wiki_URL_ATP_World_Tour)
tournois_details_Challenger <- tournois_details(wiki_URL_ATP_Challenger)
tournament_details_final <- rbind(tournois_details_ATP,tournois_details_Challenger)
#Saving for the app
write_rds(tournament_details_final, "tournament_details_final.rds")
tournament_details_final_df <- readr::read_rds("tournament_details_final.rds")
tournament_details_final_df$Debut<- as.Date(tournament_details_final_df$Debut,origin="1899-12-30")
tournament_details_final_df$Fin <- as.Date(tournament_details_final_df$Fin,origin="1899-12-30")
golem::run_dev()
golem::run_dev()
golem::run_dev()
golem::run_dev()
golem::run_dev()
golem::run_dev()
golem::run_dev()
golem::run_dev()
golem::run_dev()
golem::run_dev()
